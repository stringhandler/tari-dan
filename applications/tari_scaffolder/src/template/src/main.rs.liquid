mod cli;
mod daemon_client;



use crate::cli::Cli;
use crate::cli::Command;
use crate::daemon_client::DaemonClient;


use multiaddr::Multiaddr;
use std::str::FromStr;
use reqwest;
use serde_json::json;
use tari_utilities::hex::from_hex;

use tari_template_lib::prelude::ComponentAddress;

#[tokio::main]
async fn main() {
    let cli = Cli::init();
    let jrpc = cli.daemon_jrpc_endpoint.clone().unwrap_or_else(|| "http://127.0.0.1:18016".to_string());
    let token = cli.auth_token.clone();
    let client= DaemonClient::new(jrpc, token);
    let template_address = from_hex(&cli.template).unwrap().try_into().unwrap();
    match cli.command {
        {% for c in  commands %}
        Command::{{c.title}}(com) => {
            {% if c.is_method %}
            com.run(client, cli.dump_buckets).await;
            {% else %}
            com.run(client, template_address).await;
            {% endif %}
        }
        {% endfor %}
    }
}
